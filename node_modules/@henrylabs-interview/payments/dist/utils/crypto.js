import { sha256 } from '@noble/hashes/sha2.js';
import { bytesToHex } from '@noble/hashes/utils.js';
import crypto from 'crypto';
export function generateID(length = 12) {
    const digits = [];
    const bytes = crypto.randomBytes(length);
    for (let i = 0; i < length; i++) {
        digits.push((bytes[i] ?? 0) % 10);
    }
    return parseInt(digits.join(''));
}
export async function generateTimeBasedID(extra = '') {
    const now = Date.now(); // current time in ms
    const oneMinute = 60 * 1000;
    const ms = Math.floor(now / oneMinute) * oneMinute;
    return await hashToString(`${ms}---${extra}`);
}
export async function hashToString(input) {
    const hash = bytesToHex(sha256(new TextEncoder().encode(input)));
    // 16 hex characters = 64 bits
    return hash.slice(0, 16);
}
export function signPayload(payload, secret) {
    return crypto.createHmac('sha256', secret).update(payload).digest('hex');
}
export function genReqId() {
    return crypto.randomUUID().split('-')[0] ?? '';
}
