const path = new URL('../db-store/history.json', import.meta.url);
async function ensureFileExists() {
    const file = Bun.file(path);
    if (!(await file.exists())) {
        await Bun.write(path, '[]');
    }
}
/**
 * Reads all history records from the JSON store.
 */
export async function readHistory() {
    await ensureFileExists();
    const file = Bun.file(path);
    const text = await file.text();
    if (!text)
        return [];
    try {
        return JSON.parse(text);
    }
    catch {
        // If file somehow becomes corrupted, reset it
        await Bun.write(path, '[]');
        return [];
    }
}
/**
 * Writes a new record to the JSON store.
 */
export async function writeHistory(params) {
    const history = await readHistory();
    const now = Date.now();
    const record = {
        ...params,
        createdAt: now,
        updatedAt: now,
    };
    history.push(record);
    await Bun.write(path, JSON.stringify(history, null, 2));
    return record;
}
